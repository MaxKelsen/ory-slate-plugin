{"version":3,"sources":["../src/hooks.js"],"names":["List","head","map","path","reduce","tail","React","AlignmentPlugin","BlockquotePlugin","IndentationPlugin","CodePlugin","EmphasizePlugin","HeadingsPlugin","LinkPlugin","ListsPlugin","ParagraphPlugin","P","parse5","Document","Html","Raw","State","Plain","DEFAULT_NODE","defaultPlugins","lineBreakSerializer","deserialize","el","tagName","toLowerCase","kind","text","serialize","object","children","type","html","rules","parseHtml","parseFragment","options","terse","createInitialState","editorState","nodes","unserialize","importFromHtml","serialized","merge","states","mergedNodes","a","b","concat","mergedDocument","create","mergedEditorState","document","split","state","node","splittedDocument","splittedEditorState","toArray","handleRemoveHotKey","_","content","Promise","resolve","reject","length","windowSelectionWaitTime","handleFocusPreviousHotKey","e","isExpanded","setTimeout","selection","isAtStartOf","first","handleFocusNextHotKey","isAtEndOf","last"],"mappings":"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","file":"hooks.js","sourcesContent":["// @flow\n// FIXME #125: missing types for slate internals\n/* eslint-disable new-cap, arrow-body-style, react/display-name */\nimport { List } from 'immutable'\nimport head from 'ramda/src/head'\nimport map from 'ramda/src/map'\nimport path from 'ramda/src/path'\nimport reduce from 'ramda/src/reduce'\nimport tail from 'ramda/src/tail'\nimport React from 'react'\nimport type { Props } from './Component'\nimport AlignmentPlugin from './plugins/alignment'\nimport BlockquotePlugin from './plugins/blockquote'\nimport IndentationPlugin from './plugins/indentation'\nimport CodePlugin from './plugins/code'\nimport EmphasizePlugin from './plugins/emphasize'\nimport HeadingsPlugin from './plugins/headings'\nimport LinkPlugin from './plugins/link'\nimport ListsPlugin from './plugins/lists'\nimport ParagraphPlugin, { P } from './plugins/paragraph'\nimport parse5 from 'parse5'\n\n// FIXME #126\nimport { Document, Html, Raw, State, Plain } from 'slate'\n\nconst DEFAULT_NODE = P\n\nexport const defaultPlugins = [\n  new ParagraphPlugin(),\n  new EmphasizePlugin(),\n  new HeadingsPlugin({ DEFAULT_NODE }),\n  new LinkPlugin(),\n  new CodePlugin({ DEFAULT_NODE }),\n  new ListsPlugin({ DEFAULT_NODE }),\n  new BlockquotePlugin({ DEFAULT_NODE }),\n  new AlignmentPlugin(),\n  new IndentationPlugin()\n  // new KatexPlugin({ DEFAULT_NODE })\n]\n\nexport const lineBreakSerializer = {\n  deserialize(el: any) {\n    if (el.tagName.toLowerCase() === 'br') {\n      return { kind: 'text', text: '\\n' }\n    }\n  },\n  serialize(object: any, children: any) {\n    if (object.type === 'text' || children === '\\n') {\n      return <br />\n    }\n  }\n}\n\nexport const html = new Html({\n  rules: [...defaultPlugins, lineBreakSerializer],\n  parseHtml: parse5.parseFragment\n})\n\nconst options = { terse: true }\n\nexport const createInitialState = () => ({\n  editorState: Raw.deserialize(\n    {\n      nodes: [\n        {\n          kind: 'block',\n          type: P,\n          nodes: [\n            {\n              kind: 'text',\n              text: ''\n            }\n          ]\n        }\n      ]\n    },\n    options\n  )\n})\n\nexport const unserialize = ({\n  importFromHtml,\n  serialized,\n  editorState\n}: {\n  importFromHtml: string,\n  serialized: Object,\n  editorState: Object\n}): { editorState: Object } => {\n  if (serialized) {\n    return { editorState: Raw.deserialize(serialized, options) }\n  } else if (importFromHtml) {\n    return { editorState: html.deserialize(importFromHtml, options) }\n  } else if (editorState) {\n    return { editorState }\n  }\n\n  return createInitialState()\n}\n\nexport const serialize = ({ editorState }: any) => ({\n  serialized: Raw.serialize(editorState, options)\n})\n\nexport const merge = (states: Object[]): Object => {\n  const nodes = map(path(['editorState', 'document', 'nodes']), states)\n  const mergedNodes = reduce(\n    (a: List<any>, b: List<any>) => a.concat(b),\n    head(nodes),\n    tail(nodes)\n  )\n  const mergedDocument = Document.create({ nodes: mergedNodes })\n  const mergedEditorState = State.create({ document: mergedDocument })\n\n  return { editorState: mergedEditorState }\n}\n\nexport const split = (state: Object): Object[] => {\n  const nodes = path(['editorState', 'document', 'nodes'], state)\n\n  return nodes\n    .map((node: any) => {\n      const splittedDocument = Document.create({ nodes: List([node]) })\n      const splittedEditorState = State.create({ document: splittedDocument })\n\n      return { editorState: splittedEditorState }\n    })\n    .toArray()\n}\n\n// const position = (): {\n//   top: ?number,\n//   right: ?number,\n//   left: ?number,\n//   bottom: ?number\n// } => {\n//   if (window && window.getSelection) {\n//     const selection = window.getSelection()\n//     if (!selection.rangeCount) {\n//       return {\n//         top: null,\n//         right: null,\n//         left: null,\n//         bottom: null,\n//       }\n//     }\n//\n//     return selection.getRangeAt(0).getBoundingClientRect()\n//   }\n//\n//   if (window.document.selection) {\n//     return window.document.selection\n//       .createRange()\n//       .getBoundingClientRect()\n//   }\n//\n//   return {\n//     top: null,\n//     right: null,\n//     left: null,\n//     bottom: null,\n//   }\n// }\n\n// if editor state is empty, remove cell when backspace or delete was pressed.\nexport const handleRemoveHotKey = (\n  _: KeyboardEvent,\n  { content: { state: { editorState } } }: Props\n) =>\n  new Promise(\n    (resolve: Function, reject: Function) =>\n      Plain.serialize(editorState).length < 1 ? resolve() : reject()\n  )\n\nconst windowSelectionWaitTime = 1\n\nexport const handleFocusPreviousHotKey = (\n  e: KeyboardEvent,\n  { content: { state: { editorState } } }: Props\n) => {\n  // const isArrowUp = e.keyCode === 38\n\n  return new Promise((resolve: Function, reject: Function) => {\n    if (editorState.isExpanded) {\n      return reject()\n    }\n\n    setTimeout(() => {\n      // if (isArrowUp && next.top === current.top) {\n      //   return resolve()\n      // } else\n      if (\n        editorState.selection.isAtStartOf(editorState.document.nodes.first())\n      ) {\n        return resolve()\n      }\n      reject()\n    }, windowSelectionWaitTime)\n  })\n}\n\nexport const handleFocusNextHotKey = (\n  e: KeyboardEvent,\n  { content: { state: { editorState } } }: Props\n) => {\n  // const isArrowDown = e.keyCode === 40\n\n  return new Promise((resolve: Function, reject: Function) => {\n    if (editorState.isExpanded) {\n      return reject()\n    }\n\n    setTimeout(() => {\n      // if (isArrowDown && next.top === current.top) {\n      //   return resolve()\n      // } else\n      if (editorState.selection.isAtEndOf(editorState.document.nodes.last())) {\n        return resolve()\n      }\n      reject()\n    }, windowSelectionWaitTime)\n  })\n}\n"]}