{"version":3,"sources":["../../../src/plugins/link/index.js"],"names":["A","LinkButton","state","open","href","title","hadLinks","newTab","onRef","component","e","querySelector","focus","onClick","props","editorState","onChange","preventDefault","hasLinks","inlines","some","inline","type","newState","transform","unwrapInline","apply","isExpanded","setState","wasExpanded","handleClose","window","setTimeout","handleSubmit","wrapInline","data","collapseToEnd","insertText","extend","length","onCheck","target","checked","onHrefChange","value","onTitleChange","LinkPlugin","name","nodes","hoverButtons","toolbarButtons","deserialize","el","next","tagName","toLowerCase","kind","childNodes","create","attrs","find","serialize","object","children","get"],"mappings":"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","file":"index.js","sourcesContent":["/* eslint-disable no-alert, prefer-reflect, default-case, react/display-name */\nimport LinkIcon from 'material-ui-icons/Link'\nimport React, { Component } from 'react'\nimport TextField from 'material-ui/TextField'\nimport { ToolbarButton } from '../../helpers'\nimport Plugin from '../Plugin'\nimport Link from './node'\nimport Checkbox from 'material-ui/Checkbox'\nimport { FormControlLabel } from 'material-ui/Form'\nimport Dialog, { DialogTitle, DialogActions, DialogContent } from 'material-ui/Dialog'\nimport Button from 'material-ui/Button'\nimport { Data } from 'slate'\nimport type { Props } from '../props'\n\nexport const A = 'LINK/LINK'\n\nclass LinkButton extends Component {\n  state = {\n    open: false,\n    href: '',\n    title: '',\n    hadLinks: false,\n    newTab: false,\n  }\n\n  props: Props\n\n  input: Component<*, *, *>\n\n  onRef = (component: Component<*, *, *>) => {\n    if (!component && true) {\n      return null\n    }\n\n    const e = component.querySelector('input')\n    if (e) {\n      e.focus()\n    }\n  }\n\n  onClick = e => {\n    const { editorState, onChange } = this.props\n    e.preventDefault()\n\n    const hasLinks = editorState.inlines.some(\n      (inline: any) => inline.type === A\n    )\n\n    if (hasLinks) {\n      const newState = editorState\n        .transform()\n        .unwrapInline(A)\n        .apply()\n      onChange(newState)\n    } else if (editorState.isExpanded) {\n      this.setState({\n        open: true,\n        wasExpanded: editorState.isExpanded,\n        href: '',\n        title: '',\n        hadLinks: hasLinks,\n        newTab: false,\n      })\n    } else {\n      this.setState({\n        open: true,\n        wasExpanded: editorState.isExpanded,\n        href: '',\n        title: '',\n        hadLinks: hasLinks,\n        newTab: false,\n      })\n    }\n  }\n\n  handleClose = () => {\n    this.setState({ open: false })\n\n    const newState = this.props.editorState\n      .transform()\n      .focus()\n      .apply()\n    window.setTimeout(() => this.props.onChange(newState), 1)\n  }\n\n  handleSubmit = () => {\n    this.setState({ open: false })\n\n    if (!this.state.href) {\n      this.handleClose()\n      return\n    }\n\n    if (this.state.wasExpanded) {\n      const newState = this.props.editorState\n        .transform()\n        .focus()\n        .apply()\n        .transform()\n        .wrapInline({\n          type: A,\n          data: { href: this.state.href, newTab: this.state.newTab }\n        })\n        .collapseToEnd()\n        .apply()\n\n      window.setTimeout(() => this.props.onChange(newState), 1)\n      window.setTimeout(() => this.props.focus(), 100)\n      return\n    }\n\n    if (!this.state.title) {\n      this.handleClose()\n      return\n    }\n\n    const newState = this.props.editorState\n      .transform()\n      .insertText(this.state.title)\n      .extend(-this.state.title.length)\n      .wrapInline({\n        type: A,\n        data: { href: this.state.href }\n      })\n      .collapseToEnd()\n      .focus()\n      .apply()\n\n    this.props.onChange(newState)\n    window.setTimeout(() => this.props.focus(), 100)\n  }\n\n  onCheck = e => {\n    this.setState({ newTab: e.target.checked })\n  }\n\n  onHrefChange = e => {\n    this.setState({ href: e.target.value })\n  }\n\n  onTitleChange = e => {\n    this.setState({ title: e.target.value })\n  }\n\n  render() {\n    const { editorState } = this.props\n\n    const hasLinks = editorState.inlines.some(\n      (inline: any) => inline.type === A\n    )\n    return (\n      <span>\n        <ToolbarButton\n          onClick={this.onClick}\n          isActive={hasLinks}\n          icon={<LinkIcon />}\n        />\n          <Dialog\n            className=\"ory-prevent-blur\"\n            open={this.state.open}\n            onRequestClose={this.handleClose}\n          >\n            <DialogTitle>Create a link</DialogTitle>\n            <DialogContent>\n              {this.state.wasExpanded ? null : (\n                <div>\n                  <TextField\n                    label=\"Link title\"\n                    onChange={this.onTitleChange}\n                    value={this.state.title}\n                  />\n                </div>\n              )}\n              <div ref={this.onRef}>\n                <TextField\n                  label=\"http://example.com/my/link.html\"\n                  onChange={this.onHrefChange}\n                  value={this.state.href}\n                />\n              </div>\n              <div>\n                <FormControlLabel\n                  control={\n                    <Checkbox\n                      checked={this.state.newTab}\n                      onChange={this.onCheck}\n                      value=\"newTab\"\n                    />\n                  }\n                  label=\"Open in new tab\"\n                />\n              </div>\n            </DialogContent>\n            <DialogActions>\n              <Button\n                key=\"0\"\n                color=\"accent\"\n                onClick={this.handleClose}\n              >\n                Cancel\n              </Button>\n              <Button\n                key=\"1\"\n                color=\"primary\"\n                onClick={this.handleSubmit}\n              >\n                Submit\n              </Button>\n            </DialogActions>\n          </Dialog>\n      </span>\n    )\n  }\n}\n\nexport default class LinkPlugin extends Plugin {\n  name = 'link'\n\n  nodes = { [A]: Link }\n\n  hoverButtons = [LinkButton]\n  toolbarButtons = [LinkButton]\n\n  deserialize = (el, next) => {\n    switch (el.tagName.toLowerCase()) {\n      case 'a':\n        return {\n          kind: 'inline',\n          type: A,\n          nodes: next(el.childNodes),\n          data: Data.create({\n            href: (el.attrs.find(({ name }) => name === 'href') || {\n              value: ''\n            }).value,\n            newTab: false,\n          })\n        }\n    }\n  }\n\n  serialize = (\n    object: { type: string, kind: string, data: any },\n    children: any[]\n  ) => {\n    if (object.kind !== 'inline') {\n      return\n    }\n    switch (object.type) {\n      case A:\n        return <a href={object.data.get('href')} target={object.data.get('newTab') ? '_blank' : ''}>{children}</a>\n    }\n  }\n}\n"]}